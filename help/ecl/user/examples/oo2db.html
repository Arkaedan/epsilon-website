<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> <link rel="stylesheet" href="../../../common/css/style.css" charset="ISO-8859-1" type="text/css"><title>Complete
OO to DB comparison</title></head>
<body><h2>Complete OO to DB comparison</h2>
<code>
<b><font color="#7f0055">post</font></b>&nbsp;{<br>
&nbsp;&nbsp;<font color="#3f7f5f">--&nbsp;For&nbsp;each&nbsp;match&nbsp;in&nbsp;the&nbsp;match&nbsp;trace<br>
</font>&nbsp;&nbsp;<b><font color="#7f0055">for</font></b>&nbsp;(m&nbsp;<b><font color="#7f0055">in</font></b>&nbsp;<i><font color="#2a00ff">matchTrace</font></i>.select(m|m.isMatching))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#3f7f5f">--&nbsp;Print&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;left&nbsp;and&nbsp;the&nbsp;right&nbsp;elements&nbsp;of&nbsp;the&nbsp;match<br>
</font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#3f7f5f">--&nbsp;and&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;rule&nbsp;that&nbsp;matched&nbsp;them<br>
</font>&nbsp;&nbsp;&nbsp;&nbsp;(m.left.name&nbsp;+&nbsp;<font color="#2a00ff">'&nbsp;&lt;'</font>&nbsp;+&nbsp;m.rules.first().name&nbsp;+&nbsp;<font color="#2a00ff">'&gt;&nbsp;'</font>&nbsp;+&nbsp;m.right.name).println();<br>
&nbsp;&nbsp;}<br>
}<br>
<br>
<font color="#3f7f5f">--&nbsp;A&nbsp;class&nbsp;matches&nbsp;a&nbsp;table<br>
--&nbsp;when&nbsp;they&nbsp;have&nbsp;the&nbsp;same&nbsp;name<br>
</font><b><font color="#7f0055">rule</font></b>&nbsp;ClassWithTable<br>
&nbsp;&nbsp;<b><font color="#7f0055">match</font></b>&nbsp;c&nbsp;:&nbsp;OO!Class<br>
&nbsp;&nbsp;<b><font color="#7f0055">with</font></b>&nbsp;t&nbsp;:&nbsp;DB!Table&nbsp;{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;<b><font color="#7f0055">compare</font></b>&nbsp;:&nbsp;c.name&nbsp;=&nbsp;t.name<br>
&nbsp;&nbsp;<br>
}<br>
<br>
<font color="#3f7f5f">--&nbsp;A&nbsp;class&nbsp;matches&nbsp;a&nbsp;primary&nbsp;key<br>
--&nbsp;column&nbsp;when&nbsp;the&nbsp;column&nbsp;belongs<br>
--&nbsp;to&nbsp;a&nbsp;table&nbsp;that&nbsp;matches&nbsp;the&nbsp;class<br>
--&nbsp;and&nbsp;its&nbsp;name&nbsp;is&nbsp;equal&nbsp;to&nbsp;<br>
--&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;class&nbsp;+&nbsp;'Id'<br>
</font><b><font color="#7f0055">rule</font></b>&nbsp;ClassWithPrimaryKey<br>
&nbsp;&nbsp;<b><font color="#7f0055">match</font></b>&nbsp;c&nbsp;:&nbsp;OO!Class&nbsp;<br>
&nbsp;&nbsp;<b><font color="#7f0055">with</font></b>&nbsp;pk&nbsp;:&nbsp;DB!Column&nbsp;{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;<b><font color="#7f0055">compare</font></b>&nbsp;:&nbsp;c.matches(pk.table)&nbsp;<b><font color="#7f0055">and</font></b>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pk.name&nbsp;=&nbsp;c.name.firstToLowerCase()&nbsp;+&nbsp;<font color="#2a00ff">'Id'</font><br>
&nbsp;&nbsp;<br>
}<br>
<br>
<font color="#3f7f5f">--&nbsp;An&nbsp;attribute&nbsp;matches&nbsp;a&nbsp;column<br>
--&nbsp;if&nbsp;the&nbsp;owner&nbsp;of&nbsp;the&nbsp;attribute<br>
--&nbsp;matches&nbsp;the&nbsp;table&nbsp;of&nbsp;the&nbsp;column<br>
--&nbsp;and&nbsp;their&nbsp;names&nbsp;are&nbsp;equal&nbsp;<br>
</font><b><font color="#7f0055">rule</font></b>&nbsp;AttributeWithColumn&nbsp;<br>
&nbsp;&nbsp;<b><font color="#7f0055">match</font></b>&nbsp;a&nbsp;:&nbsp;OO!Attribute<br>
&nbsp;&nbsp;<b><font color="#7f0055">with</font></b>&nbsp;c&nbsp;:&nbsp;DB!Column&nbsp;{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;<b><font color="#7f0055">compare</font></b>&nbsp;:&nbsp;a.name&nbsp;=&nbsp;c.name&nbsp;<b><font color="#7f0055">and</font></b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.owner.matches(c.table)<br>
&nbsp;&nbsp;<br>
}<br>
<br>
<font color="#3f7f5f">--&nbsp;An&nbsp;ancestor&nbsp;class&nbsp;matches&nbsp;a&nbsp;foreign&nbsp;key<br>
--&nbsp;if&nbsp;the&nbsp;table&nbsp;of&nbsp;the&nbsp;keys'&nbsp;parent&nbsp;matches<br>
--&nbsp;the&nbsp;class&nbsp;and&nbsp;there&nbsp;exists&nbsp;a&nbsp;descendant<br>
--&nbsp;class&nbsp;that&nbsp;matches&nbsp;the&nbsp;table&nbsp;of&nbsp;the&nbsp;keys'<br>
--&nbsp;child&nbsp;and&nbsp;has&nbsp;a&nbsp;suitable&nbsp;name<br>
</font><b><font color="#7f0055">rule</font></b>&nbsp;AncestorWithForeignKey<br>
&nbsp;&nbsp;<b><font color="#7f0055">match</font></b>&nbsp;c&nbsp;:&nbsp;OO!Class<br>
&nbsp;&nbsp;<b><font color="#7f0055">with</font></b>&nbsp;fk&nbsp;:&nbsp;DB!ForeignKey&nbsp;{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;<font color="#3f7f5f">--&nbsp;The&nbsp;rule&nbsp;is&nbsp;executed&nbsp;only&nbsp;for&nbsp;classes<br>
</font>&nbsp;&nbsp;<font color="#3f7f5f">--&nbsp;that&nbsp;are&nbsp;ancestors&nbsp;of&nbsp;other&nbsp;classes<br>
</font>&nbsp;&nbsp;<b><font color="#7f0055">guard</font></b>&nbsp;:&nbsp;c.extendedBy.size()&nbsp;&gt;&nbsp;0<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;<b><font color="#7f0055">compare</font></b>&nbsp;:&nbsp;c.matches(fk.parent.table)&nbsp;<b><font color="#7f0055">and</font></b>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.extendedBy.exists(ex|ex.matches(fk.child.table)&nbsp;<b><font color="#7f0055">and</font></b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fk.child.name&nbsp;=&nbsp;c.name.firstToLowerCase()&nbsp;+&nbsp;<font color="#2a00ff">'Id'</font>)<br>
&nbsp;&nbsp;<br>
}<br>
<br>
<font color="#3f7f5f">--&nbsp;A&nbsp;referecnes&nbsp;matches&nbsp;a&nbsp;foreign&nbsp;key<br>
--&nbsp;if&nbsp;the&nbsp;table&nbsp;of&nbsp;the&nbsp;parent&nbsp;key<br>
--&nbsp;matches&nbsp;the&nbsp;owner&nbsp;of&nbsp;the&nbsp;reference,<br>
--&nbsp;the&nbsp;table&nbsp;of&nbsp;the&nbsp;child&nbsp;key&nbsp;matches<br>
--&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;reference&nbsp;and&nbsp;the<br>
--&nbsp;name&nbsp;of&nbsp;the&nbsp;child&nbsp;key&nbsp;equals&nbsp;the&nbsp;<br>
--&nbsp;name&nbsp;of&nbsp;the&nbsp;reference&nbsp;+&nbsp;'Id'<br>
</font><b><font color="#7f0055">rule</font></b>&nbsp;ReferenceWithForeignKey<br>
&nbsp;&nbsp;<b><font color="#7f0055">match</font></b>&nbsp;r&nbsp;:&nbsp;OO!Reference<br>
&nbsp;&nbsp;<b><font color="#7f0055">with</font></b>&nbsp;fk&nbsp;:&nbsp;DB!ForeignKey&nbsp;{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;<b><font color="#7f0055">compare</font></b>&nbsp;:&nbsp;r.owner.matches(fk.parent.table)&nbsp;<b><font color="#7f0055">and</font></b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.type.matches(fk.child.table)&nbsp;<b><font color="#7f0055">and</font></b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fk.child.name&nbsp;=&nbsp;r.name&nbsp;+&nbsp;<font color="#2a00ff">'Id'</font><br>
&nbsp;&nbsp;<br>
}<br>
<br>
<font color="#3f7f5f">--&nbsp;A&nbsp;reference&nbsp;matches&nbsp;a&nbsp;foreign&nbsp;key<br>
--&nbsp;child&nbsp;if&nbsp;the&nbsp;reference&nbsp;matches<br>
--&nbsp;the&nbsp;foreign&nbsp;key&nbsp;<br>
</font><b><font color="#7f0055">rule</font></b>&nbsp;ReferenceWithForeignKeyChild<br>
&nbsp;&nbsp;<b><font color="#7f0055">match</font></b>&nbsp;r&nbsp;:&nbsp;OO!Reference<br>
&nbsp;&nbsp;<b><font color="#7f0055">with</font></b>&nbsp;c&nbsp;:&nbsp;DB!Column&nbsp;{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;<b><font color="#7f0055">compare</font></b>&nbsp;:&nbsp;DB!ForeignKey.allInstances.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists(fk|r.matches(fk)&nbsp;<b><font color="#7f0055">and</font></b>&nbsp;fk.child&nbsp;=&nbsp;c)<br>
<br>
}
</code>
</body></html>